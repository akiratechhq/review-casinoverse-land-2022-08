{{> partials/splash}}

[TOC]

## Details

- **Client** {{client_name}}
- **Date** {{date}}
- **Lead reviewer** Daniel Luca ([@cleanunicorn](https://twitter.com/cleanunicorn))
- **Reviewers** Daniel Luca ([@cleanunicorn](https://twitter.com/cleanunicorn)), Andrei Simion ([@andreiashu](https://twitter.com/andreiashu))
- **Repository**: [{{project_name}}]({{source_repository}})
- **Commit hash** `{{commit_hash}}`
- **Technologies**
  - Solidity
  - Node.JS

## Issues Summary

| SEVERITY       |    OPEN    |    CLOSED    |
|----------------|:----------:|:------------:|
{{#issues_summary}}
|  {{severity}}  |  {{open}}  |  {{closed}}  |
{{/issues_summary}}

## Executive summary

This report represents the results of the engagement with **{{client_name}}** to review **{{project_name}}**.

The review was conducted over the course of **{{review_period}}** from **{{date_interval}}**. A total of **{{person_days}} person-days** were spent reviewing the code.

## Scope

The initial review focused on the [{{project_name}}]({{source_repository}}) repository, identified by the commit hash `{{commit_hash}}`.

We focused on manually reviewing the codebase, searching for security issues such as, but not limited to, re-entrancy problems, transaction ordering, block timestamp dependency, exception handling, call stack depth limitation, integer overflow/underflow, self-destructible contracts, unsecured balance, use of origin, costly gas patterns, architectural problems, code readability.

**Includes:**
- code/contracts/Land.sol


## Recommendations

We identified a few possible general improvements that are not security issues during the review, which will bring value to the developers and the community reviewing and using the product.

### Increase the number of tests

A good rule of thumb is to have 100% test coverage. This does not guarantee the lack of security problems, but it means that the desired functionality behaves as intended. The negative tests also bring a lot of value because not allowing some actions to happen is also part of the desired behavior.

## Issues

{{#issues}}

### [{{title}}]({{url}})
![Issue status: {{status}}](https://img.shields.io/static/v1?label=Status&message={{status}}&color={{status_color}}&style=flat-square) ![{{severity}}](https://img.shields.io/static/v1?label=Severity&message={{severity}}&color={{severity_color}}&style=flat-square)

{{{body}}}

---

{{/issues}}

## Artifacts

### Surya

SÅ«rya is a utility tool for smart contract systems. It provides a number of visual outputs and information about the structure of smart contracts. It also supports querying the function call graph in multiple ways to aid in the manual inspection and control flow analysis of contracts.

## SÅ«rya's Description Report

### Files Description Table


|  File Name  |  SHA-1 Hash  |
|-------------|--------------|
| ./code/contracts/Land.sol | a326ec1307afd3a679ceaddaca7ecba5b73d9733 |


### Contracts Description Table


|  Contract  |         Type        |       Bases      |                  |                 |
|:----------:|:-------------------:|:----------------:|:----------------:|:---------------:|
|     â””      |  **Function Name**  |  **Visibility**  |  **Mutability**  |  **Modifiers**  |
||||||
| **Land** | Implementation | ERC721, ERC2981, ReentrancyGuard, Ownable, Pausable |||
| â”” | <Constructor> | Public â—ï¸ | ğŸ›‘  | ERC721 |
| â”” | setPreviewURI | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | setMaxMintPerAddress | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | mint | External â—ï¸ |  ğŸ’µ | whenNotPaused isCallerValid isTotalMintedExceedsMaxSupply isValidAmount isNFTBalanceExceedsMaxMintPerAddress isWhitelisted |
| â”” | batchMint | External â—ï¸ |  ğŸ’µ | whenNotPaused isCallerValid isTotalMintedExceedsMaxSupply isValidAmount isNFTBalanceExceedsMaxMintPerAddress isWhitelisted |
| â”” | ownerMint | External â—ï¸ | ğŸ›‘  | onlyOwner isTotalMintedExceedsMaxSupply isNFTBalanceExceedsMaxMintPerAddress |
| â”” | _batchMintNFT | Private ğŸ” | ğŸ›‘  | |
| â”” | _mintNFT | Private ğŸ” | ğŸ›‘  | isTokenIdValid |
| â”” | setMintPrice | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | setWithdrawalRecipient | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | setBaseTokenURI | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | setContractURI | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | tokenURI | Public â—ï¸ |   | isTokenExist |
| â”” | setMerkleRoot | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | pause | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | unpause | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | enableBaseURIMode | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | disableBaseURIMode | External â—ï¸ | ğŸ›‘  | onlyOwner |
| â”” | withdraw | External â—ï¸ | ğŸ›‘  | onlyOwner nonReentrant isValidRecipient isBalanceEnough |
| â”” | withdrawAll | External â—ï¸ | ğŸ›‘  | onlyOwner isValidRecipient isBalanceNotZero |
| â”” | _withdraw | Private ğŸ” | ğŸ›‘  | |
| â”” | getContractBalance | External â—ï¸ |   | onlyOwner |
| â”” | getMerkleRoot | External â—ï¸ |   | onlyOwner |
| â”” | getMaxMintPerAddress | External â—ï¸ |   | onlyOwner |
| â”” | isValidMerkleProof | Private ğŸ” |   | |
| â”” | supportsInterface | Public â—ï¸ |   |NOâ—ï¸ |
| â”” | setRoyaltyInfo | Public â—ï¸ | ğŸ›‘  | onlyOwner |


### Legend

|  Symbol  |  Meaning  |
|:--------:|-----------|
|    ğŸ›‘    | Function can modify state |
|    ğŸ’µ    | Function is payable |

#### Graphs

![Land Graph](./static/Land_graph.png)


![Land Inheritance](./static/Land_inheritance.png)


#### Describe

```text
$ npx surya describe code/contracts/Land.sol       
npx: installed 64 in 7.099s
 +  Land (ERC721, ERC2981, ReentrancyGuard, Ownable, Pausable)
    - [Pub] <Constructor> #
       - modifiers: ERC721
    - [Ext] setPreviewURI #
       - modifiers: onlyOwner
    - [Ext] setMaxMintPerAddress #
       - modifiers: onlyOwner
    - [Ext] mint ($)
       - modifiers: whenNotPaused,isCallerValid,isTotalMintedExceedsMaxSupply,isValidAmount,isNFTBalanceExceedsMaxMintPerAddress,isWhitelisted
    - [Ext] batchMint ($)
       - modifiers: whenNotPaused,isCallerValid,isTotalMintedExceedsMaxSupply,isValidAmount,isNFTBalanceExceedsMaxMintPerAddress,isWhitelisted
    - [Ext] ownerMint #
       - modifiers: onlyOwner,isTotalMintedExceedsMaxSupply,isNFTBalanceExceedsMaxMintPerAddress
    - [Prv] _batchMintNFT #
    - [Prv] _mintNFT #
       - modifiers: isTokenIdValid
    - [Ext] setMintPrice #
       - modifiers: onlyOwner
    - [Ext] setWithdrawalRecipient #
       - modifiers: onlyOwner
    - [Ext] setBaseTokenURI #
       - modifiers: onlyOwner
    - [Ext] setContractURI #
       - modifiers: onlyOwner
    - [Pub] tokenURI
       - modifiers: isTokenExist
    - [Ext] setMerkleRoot #
       - modifiers: onlyOwner
    - [Ext] pause #
       - modifiers: onlyOwner
    - [Ext] unpause #
       - modifiers: onlyOwner
    - [Ext] enableBaseURIMode #
       - modifiers: onlyOwner
    - [Ext] disableBaseURIMode #
       - modifiers: onlyOwner
    - [Ext] withdraw #
       - modifiers: onlyOwner,nonReentrant,isValidRecipient,isBalanceEnough
    - [Ext] withdrawAll #
       - modifiers: onlyOwner,isValidRecipient,isBalanceNotZero
    - [Prv] _withdraw #
    - [Ext] getContractBalance
       - modifiers: onlyOwner
    - [Ext] getMerkleRoot
       - modifiers: onlyOwner
    - [Ext] getMaxMintPerAddress
       - modifiers: onlyOwner
    - [Prv] isValidMerkleProof
    - [Pub] supportsInterface
    - [Pub] setRoyaltyInfo #
       - modifiers: onlyOwner


 ($) = payable function
 # = non-constant function
  
```

### Coverage

No coverage available.

### Tests

```text
$ npm run test                                   

> casinoverse-land@1.0.0 test /home/daniel/Development/github.com/akiratechhq/review-casinoverse-land-2022-08/code
> hardhat test



  Land
    deployment
      âœ” deployer is owner
      âœ” should return the expected name and symbol
      âœ” should return MAX_SUPPLY
      âœ” should return withdrawalRecipient address
      âœ” should return the initial base uri
      âœ” should return the uri suffix
      âœ” should return merkle root
      âœ” should return max mint per wallet address
    setMintingPrice
      âœ” should return mintPrice
      âœ” should be able to set new minting price
      âœ” should emit event MintPriceChanged
    setMerkleRoot
      âœ” should be able to set new merkle root
      âœ” should emit event MerkleRootChanged (38ms)
    setWithdrawalRecipient
      âœ” sould be able to set new recipient address
      âœ” should emit event WithdrawalRecipientChanged
    setMaxMintPerAddress
      âœ” sould be able to set new max mint per wallet address (154ms)
      âœ” sould emit event MaxMintPerAddressChanged
    setBaseTokenURI
      âœ” sould be able to set new base token uri
      âœ” sould emit event BaseTokenURIChanged
    getContractBalance
      âœ” sould return contract balance
    pausing
      âœ” should return if contract is paused
      âœ” should be able to pause contract
      âœ” should be able to unpause contract
    enable disable base uri mode
      âœ” should be able to enable base uri mode
      âœ” should be able to disable base uri mode
      âœ” should emit event BaseURIModeChanged
      âœ” should return base uri if base uri mode is true
      âœ” should return token specific uri if base uri mode is false (76ms)
      âœ” should return preview uri if token uri is empty
    batch minting
      âœ” should be able to batch mint nft
      âœ” should emit event NFTBatchMint
      âœ” should be able to batch mint nft from using contract if owner (97ms)
      âœ” should not be able to batch mint if contract is paused, should be reverted with error message 'Pausable: paused' (42ms)
      âœ” duplicate token id, should be reverted with error message 'ERC721: token already minted'
      âœ” token id should not exceed max supply, should be reverted with error message 'Invalid token id'
      âœ” invalid mint price amount, should be reverted with error message 'Invalid Amount'
      âœ” maxed supply, should be reverted with error message 'Max Reached' (101ms)
      âœ” max mint per address, should be reverted with error message 'Max nft per address reached'
      âœ” not whitelisted, should be reverted with error message 'Not on whitelist'
      âœ” should not allow contract to call batch mint, should be reverted with error message 'Not allowed' (41ms)
    owner minting
      âœ” should be able to owner mint nft
      âœ” should emit event NFTBatchMint
      âœ” duplicate token id, should be reverted with error message 'ERC721: token already minted'
      âœ” token id should not exceed max supply, should be reverted with error message 'Invalid token id'
      âœ” maxed supply, should be reverted with error message 'Max Reached' (86ms)
      âœ” max mint per address, should be reverted with error message 'Max nft per address reached'
    minting
      âœ” should be able to mint nft
      âœ” should emit event NFTSingleMint
      âœ” should be able to mint nft using contract if owner (55ms)
      âœ” should be able to mint nft with different accs (316ms)
      âœ” token id should not exceed max supply, should be reverted with error message 'Invalid token id'
      âœ” token already minted, should be reverted with error message 'ERC721: token already minted'
      âœ” should not be able to mint if contract is paused, should be reverted with error message 'Pausable: paused'
      âœ” maxed supply, should be reverted with error message 'Max Reached' (89ms)
      âœ” invalid mint price amount, should be reverted with error message 'Invalid Amount'
      âœ” not whitelisted, should be reverted with error message 'Not on whitelist'
      âœ” max mint per address, should be reverted with error message 'Max nft per address reached' (77ms)
      âœ” should not allow contract to call mint, should be reverted with error message 'Not allowed'
    withdrawAll
      âœ” should be able to withdraw all balance (79ms)
      âœ” should emit event Withdraw (75ms)
      âœ” invalid recipient, should be reverted with error message 'Invalid Recipient'
      âœ” invalid balance, should be reverted with error message 'No Balance'
      âœ” caller is not owner, should be reverted with errror message 'Ownable: caller is not the owner'
    withdraw
      âœ” should be able to withdraw balance (49ms)
      âœ” should be able to withdraw balance (49ms)
      âœ” should be able to withdraw all balance (38ms)
      âœ” invalid recipient, should be reverted with error message 'Invalid Recipient'
      âœ” invalid balance, should be reverted with error message 'Not Enough Balance'
      âœ” caller is not owner, should be reverted with errror message 'Ownable: caller is not the owner'
    royalty info
      âœ” should return current royalty info
      âœ” should be able to set new royalty info
      âœ” should emit event RoyaltyInfoChanged
    setContractURI
      âœ” should be able to set new contract URI
      âœ” should emit event ContractURIChanged
    setPreviewURI
      âœ” should be able to set new preview URI
      âœ” should emit event PreviewURIChanged


  76 passing (9s)
```

## License

This report falls under the terms described in the included [LICENSE](./LICENSE).

{{> partials/features}}
<link rel="stylesheet" href="./style/print.css"/>
